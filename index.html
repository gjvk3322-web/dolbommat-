<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RE:BOOT PRO v2.0 | ì „ëµ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .dashboard-container { max-width: 1122px; margin: 0 auto; background: #ffffff; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .step-col { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; }
        .step-header { font-size: 1.05rem; font-weight: 800; text-align: center; padding: 12px; border-radius: 8px; margin-bottom: 20px; color: white; }
        .box-wrapper { background: #ffffff; border: 1px solid #cbd5e1; border-radius: 8px; overflow: hidden; margin-bottom: 16px; }
        .box-title { background-color: #f1f5f9; color: #334155; padding: 10px 14px; font-size: 0.9rem; font-weight: 700; border-bottom: 1px solid #e2e8f0; }
        textarea { width: 100%; height: 95px; border: none; padding: 14px; font-size: 0.9rem; line-height: 1.5; outline: none; resize: none; }
        .history-card { border-left: 5px solid #3b82f6; page-break-inside: avoid; }
        /* íƒœê·¸ ìŠ¤íƒ€ì¼ */
        select.status-select { outline: none; border: 1px solid #cbd5e1; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; }
    </style>
</head>
<body class="py-10">

    <div class="max-w-[1122px] mx-auto mb-6 flex justify-between items-end no-print">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">RE:BOOT <span class="text-blue-600">PRO v2.0</span></h1>
            <p class="text-sm text-gray-500 mt-1 font-medium">í˜„í™© ê¸°ë°˜ ë„¤ì´ë° & ê°œë³„ ì¶”ì¶œ ì§€ì› ëŒ€ì‹œë³´ë“œ</p>
        </div>
        <div class="flex gap-3 items-center">
            <select id="strategy-status" class="status-select bg-white text-slate-700 h-[48px] px-4 cursor-pointer">
                <option value="ì´ˆì•ˆ ì‘ì„±ì¤‘">ğŸ“ ì´ˆì•ˆ ì‘ì„±ì¤‘</option>
                <option value="ê²€í†  í•„ìš”">ğŸ” ê²€í†  í•„ìš”</option>
                <option value="ì‹¤í–‰ í™•ì •">ğŸš€ ì‹¤í–‰ í™•ì •</option>
            </select>
            <button onclick="saveToHistory()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold shadow-md transition-all">
                <i class="fas fa-save mr-2"></i> ì•„ì¹´ì´ë¸Œ ì €ì¥
            </button>
            <button onclick="exportFullPDF()" class="bg-gray-800 hover:bg-gray-900 text-white px-6 py-3 rounded-lg font-bold shadow-md transition-all">
                ì „ì²´ PDF
            </button>
        </div>
    </div>

    <div class="dashboard-container mb-10 border-b-4 border-slate-200" id="canvas-area">
        <div class="grid grid-cols-3 gap-6">
            <div class="step-col">
                <div class="step-header bg-slate-700">STEP 01. ë¬¸ì œ ì¸ì‹</div>
                <div class="box-wrapper"><div class="box-title">í˜„í™© (â€» ì „ëµì˜ ì œëª©ì´ ë©ë‹ˆë‹¤)</div><textarea id="p1_1" placeholder="ì˜ˆ: ë§¤ì¶œ ì €í•˜ë¡œ ì¸í•œ íšŒì‚¬ìš´ì˜ ìœ„ê¸°"></textarea></div>
                <div class="box-wrapper"><div class="box-title">ì›ì¸ ê·œëª…</div><textarea id="p1_2" placeholder="ì˜ˆ: í° ë§¤íŠ¸ë¡œ ì‹œì¥ ë³€í™”"></textarea></div>
                <div class="box-wrapper"><div class="box-title">í•µì‹¬ ê³¼ì œ ë„ì¶œ</div><textarea id="p1_3" placeholder="ì˜ˆ: ìš°ë¦¬ë„ 1,000 ë§¤íŠ¸ ì¶œì‹œ"></textarea></div>
            </div>
            <div class="step-col">
                <div class="step-header bg-blue-700">STEP 02. í•´ê²° ë°©ì•ˆ íƒìƒ‰</div>
                <div class="box-wrapper"><div class="box-title">í•´ê²° ëª©í‘œ ìˆ˜ë¦½</div><textarea id="p2_1" placeholder="ì˜ˆ: ì›” ë§¤ì¶œ 50ì–µ ë‹¬ì„±"></textarea></div>
                <div class="box-wrapper"><div class="box-title">í•´ê²° ë°©ì•ˆ íƒìƒ‰</div><textarea id="p2_2" placeholder="ì˜ˆ: SNS í˜‘ì°¬ ë° ë°•ëŒíšŒ, ì¸í„°ë„· íŒë§¤"></textarea></div>
                <div class="box-wrapper"><div class="box-title">ëŒ€ì•ˆë³„ í‰ê°€</div><textarea id="p2_3" placeholder="ì˜ˆ: ë°•ëŒíšŒëŠ” ë¹„ìš©ì´ ë†’ìœ¼ë‚˜ íš¨ê³¼ê°€ ì¦‰ê°ì ì„"></textarea></div>
            </div>
            <div class="step-col">
                <div class="step-header bg-indigo-700">STEP 03. ì„ ì • ë° ì‹¤í–‰</div>
                <div class="box-wrapper"><div class="box-title">ìµœì ì•ˆ ì„ ì •</div><textarea id="p3_1" placeholder="ì˜ˆ: ì¸í„°ë„· íŒë§¤ë¥¼ ë©”ì¸ìœ¼ë¡œ í•˜ê³  SNS í˜‘ì°¬ ë³‘í–‰"></textarea></div>
                <div class="box-wrapper"><div class="box-title">ì‹¤í–‰ ê³„íš ìˆ˜ë¦½</div><textarea id="p3_2" placeholder="ì˜ˆ: 1ì£¼ì°¨ ìƒì„¸í˜ì´ì§€ ì œì‘, 2ì£¼ì°¨ ë§˜ì¹´í˜ ì²´í—˜ë‹¨ ëª¨ì§‘"></textarea></div>
            </div>
        </div>
    </div>

    <div class="max-w-[1122px] mx-auto">
        <h2 class="text-2xl font-extrabold text-gray-800 mb-6 flex items-center">
            <i class="fas fa-layer-group text-blue-600 mr-3"></i> í™•ì •ëœ ì „ëµ ì•„ì¹´ì´ë¸Œ
            <span id="history-count" class="ml-3 bg-blue-100 text-blue-700 text-sm font-bold px-3 py-1 rounded-full">0ê±´</span>
        </h2>
        <div id="history-container" class="space-y-6"></div>
    </div>

    <script>
        const fields = ['p1_1', 'p1_2', 'p1_3', 'p2_1', 'p2_2', 'p2_3', 'p3_1', 'p3_2'];
        const labels = ["í˜„í™©", "ì›ì¸", "ê³¼ì œ", "ëª©í‘œ", "ëŒ€ì•ˆ", "í‰ê°€", "ê²°ì •", "ê³„íš"];

        window.onload = () => renderHistory();

        function saveToHistory() {
            let hasContent = false;
            let currentStrategy = { 
                id: Date.now(), 
                date: new Date().toLocaleString('ko-KR'), 
                status: document.getElementById('strategy-status').value,
                details: {} 
            };

            fields.forEach((id, idx) => {
                const val = document.getElementById(id).value.trim();
                if(val) { currentStrategy.details[labels[idx]] = val; hasContent = true; }
            });

            if(!hasContent) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            let history = JSON.parse(localStorage.getItem('pro_v2_history') || "[]");
            
            // ë§Œì•½ ë¶ˆëŸ¬ì™€ì„œ ìˆ˜ì • ì¤‘ì´ë˜ ë°ì´í„°ë¼ë©´ ë®ì–´ì“°ê¸° ë¡œì§ (ê°„ë‹¨íˆ í•˜ê¸° ìœ„í•´ ìƒˆ í•­ëª©ìœ¼ë¡œ ì¶”ê°€)
            history.unshift(currentStrategy);
            localStorage.setItem('pro_v2_history', JSON.stringify(history));

            fields.forEach(id => document.getElementById(id).value = "");
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            const history = JSON.parse(localStorage.getItem('pro_v2_history') || "[]");
            document.getElementById('history-count').innerText = `${history.length}ê±´`;

            if(history.length === 0) {
                container.innerHTML = `<div class="text-center py-10 bg-white rounded-xl shadow-sm border border-gray-200 text-gray-400">ì €ì¥ëœ ì „ëµì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            container.innerHTML = "";
            history.forEach((item, index) => {
                // ëŒ€í‘œë‹˜ ìš”ì²­: 'í˜„í™©' ë‚´ìš©ì„ ì œëª©ìœ¼ë¡œ! (ì—†ìœ¼ë©´ ê¸°ë³¸ ì œëª©)
                const title = item.details["í˜„í™©"] || `ìƒˆë¡œìš´ ë„ì•½ ì „ëµ #${history.length - index}`;
                
                // ìƒíƒœë³„ ë¼ë²¨ ìƒ‰ìƒ
                let statusColor = "bg-gray-100 text-gray-600";
                if(item.status.includes("ê²€í† ")) statusColor = "bg-orange-100 text-orange-700";
                if(item.status.includes("í™•ì •")) statusColor = "bg-green-100 text-green-700";

                const detailsHtml = Object.entries(item.details).map(([key, val]) => {
                    if(key === "í˜„í™©") return ""; // í˜„í™©ì€ ì œëª©ìœ¼ë¡œ ì¼ìœ¼ë‹ˆ ë³¸ë¬¸ì—ì„œëŠ” ìˆ¨ê¹€ ì²˜ë¦¬(ì›í•˜ë©´ ë³´ì´ê²Œ ë³€ê²½ ê°€ëŠ¥)
                    return `
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <div class="text-[11px] font-extrabold text-blue-600 mb-1">${key}</div>
                        <div class="text-[13px] text-gray-700">${val.replace(/\n/g, '<br>')}</div>
                    </div>`;
                }).join('');

                container.innerHTML += `
                    <div id="card-${item.id}" class="history-card bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                        <div class="flex justify-between items-start border-b border-gray-100 pb-4 mb-4">
                            <div>
                                <span class="${statusColor} text-xs font-bold px-2 py-1 rounded mr-2">${item.status}</span>
                                <h3 class="text-lg font-extrabold text-gray-900 mt-2">${title}</h3>
                                <p class="text-xs text-gray-400 mt-1"><i class="far fa-clock"></i> ${item.date}</p>
                            </div>
                            <div class="flex gap-2 no-print">
                                <button onclick="loadStrategy(${item.id})" class="text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 px-3 py-1.5 rounded font-bold transition">
                                    <i class="fas fa-edit"></i> ìº”ë²„ìŠ¤ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
                                </button>
                                <button onclick="exportSingleCard(${item.id})" class="text-sm bg-gray-100 text-gray-700 hover:bg-gray-200 px-3 py-1.5 rounded font-bold transition">
                                    <i class="fas fa-download"></i> ì¹´ë“œë§Œ PDF ì €ì¥
                                </button>
                                <button onclick="deleteStrategy(${item.id})" class="text-sm text-red-400 hover:text-red-600 p-1.5 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            ${detailsHtml}
                        </div>
                    </div>
                `;
            });
        }

        // ìº”ë²„ìŠ¤ë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì •ìš©)
        function loadStrategy(id) {
            const history = JSON.parse(localStorage.getItem('pro_v2_history') || "[]");
            const item = history.find(h => h.id === id);
            if(item) {
                fields.forEach((fieldId, idx) => {
                    document.getElementById(fieldId).value = item.details[labels[idx]] || "";
                });
                window.scrollTo({ top: 0, behavior: 'smooth' });
                // ì•Œë¦¼ì°½ ëŒ€ì‹  ê°€ë³ê²Œ í‘œì‹œ
                let toast = document.createElement('div');
                toast.className = "fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-xl z-50 font-bold";
                toast.innerText = "ìº”ë²„ìŠ¤ë¡œ ë‚´ìš©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ ì €ì¥í•´ì£¼ì„¸ìš”.";
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        }

        // íŠ¹ì • ì¹´ë“œ ì‚­ì œ
        function deleteStrategy(id) {
            if(confirm("ì´ ì „ëµì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                let history = JSON.parse(localStorage.getItem('pro_v2_history') || "[]");
                history = history.filter(h => h.id !== id);
                localStorage.setItem('pro_v2_history', JSON.stringify(history));
                renderHistory();
            }
        }

        // ê°œë³„ ì¹´ë“œë§Œ PDF ì¶œë ¥
        function exportSingleCard(id) {
            const element = document.getElementById(`card-${id}`);
            // PDF ì¶œë ¥ì‹œ ë²„íŠ¼ë“¤(no-print)ì„ ì„ì‹œë¡œ ìˆ¨ê¸°ê¸° ìœ„í•´ í´ë˜ìŠ¤ í™œìš©
            const buttons = element.querySelector('.no-print');
            buttons.style.display = 'none';

            const opt = {
                margin: 10,
                filename: `Strategy_Card_${id}.pdf`,
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            
            html2pdf().set(opt).from(element).save().then(() => {
                buttons.style.display = 'flex'; // ì €ì¥ í›„ ë‹¤ì‹œ ë³´ì´ê¸°
            });
        }

        function exportFullPDF() {
            const element = document.body; // ì „ì²´ í™”ë©´ ì €ì¥ ì›í•  ì‹œ
            const opt = {
                margin: [10, 0, 10, 0],
                filename: `REBOOT_Full_Archive.pdf`,
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 1.5 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>
